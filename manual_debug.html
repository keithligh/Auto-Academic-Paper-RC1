<!DOCTYPE html>
<html>

<head>
    <title>Manual TikZ Debug</title>
</head>

<body>
    <h1>TikZ Debugger</h1>
    <p>This page simulates the exact iframe injection used in the app.</p>

    <h2>Problematic TikZ Code</h2>
    <div id="container"></div>

    <script>
        // The exact code generated by our "Robust Flattening" logic
        // We simulate the result of sanitizeStr
        // TIER 3 Flattening means NO NEWLINES.
        // TIER 2 Comment Stripping means NO COMMENTS.

        const rawTikz = `\\node (anx) [rectangle, draw] {Empathize 100\\%}; \\node (define) [rectangle, draw, below of=anx] {Define}; \\draw[->] (anx) -- (define);`;

        const finalOptions = `[node distance=3cm, auto]`;

        const iframeHtml = `<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-tikzjax@latest/css/fonts.css">
  <script src="https://tikzjax.com/v1/tikzjax.js"><\/script>
  <style>body { margin: 0; }</style>
  <script>
      console.log("DEBUG TIKZ INPUT:", "${rawTikz.replace(/\\/g, '\\\\')}");
  <\/script>
</head>
<body>
  <div class="tikzjax-container">
    <script type="text/tikz">
      \\usetikzlibrary{arrows,shapes,calc,positioning,decorations.pathreplacing}
      \\begin{tikzpicture}${finalOptions}
      ${rawTikz}
      \\end{tikzpicture}
    <\/script>
  </div>
</body>
</html>`;

        const srcdoc = iframeHtml.replace(/&/g, '&amp;').replace(/"/g, '&quot;');

        const container = document.getElementById('container');
        const iframe = document.createElement('iframe');
        iframe.srcdoc = srcdoc;
        iframe.style.width = "100%";
        iframe.style.height = "500px";
        iframe.style.border = "1px solid black";
        container.appendChild(iframe);
    </script>
</body>

</html>